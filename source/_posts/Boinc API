---
title: Boinc API
date: 2019-12-09 18:28:48
tags: Boinc
---

# Boinc C++ 任务 API 

<!-- more -->

​		主要是对[Boinc 文档](https://boinc.berkeley.edu/trac/wiki/BasicApi)的一些笔记。

​		Boinc 提供了 `boinc_api.h` 大多都有C接口，因此可以移植给别的语言（通过其他语言的c/c++扩展机制，如nodejs python), API协定返回整数错误码，除0之外的所有值应该被是为失败。

# 核心API

### 初始化

```c++
boinc_init()
```



​		函数主要作用是在内部判断是否已经初始化，如果是多线程就准备好线程，初始化内部变量，重定向输出，等等准备工作

### 多线程或多进程

```c++
// 初始化 option 结构
static BOINC_OPTIONS options;
boinc_options_defaults(options) // 函数会给option赋值
// 如果是只是用多线程,默认是使用多进程
options.multi_thread = true;
// 准备需要用到的线程
boinc_init_options(&option)
```

​		在任何时候创建多进程或者多线程的时候可以调用上面的函数进行创建。

### 非CPU计算

```c++
// 初始化 option 结构
static BOINC_OPTIONS options;
boinc_options_defaults(options);
options.normal_thread_priority = true;
boinc_init_options(&options);
```

​		赋值之后会调用windows提供的API降低当前创建线程的优先级



### 结束

```c++
int boinc_finish(int state)
```

​		boinc_finish 函数会根据 state的值来确定是否结束当前任务，如果 state是0那么boinc会结束任务，并返回0，如果state是非零那么boinc会重启任务的应用程序

```c++
boinc_finish_message(int status, const char* msg, bool is_notice);
```

​		调用此API会向GUI中发送消息。

### 解析文件路径	

```c++
int boinc_resolve_filename(char *logical_name, char *physical_name, int len);
```

​		有时需要读取本地文件（例如任务配套的数据文件），但是因为无法预知路径，所以Boinc提供了这个api，接受名称和和一个char *类型字符串指针和长度，之后函数会将地址赋值给 physical_name 以供函数使用



### IO包装函数

```c++
boinc_fopen(char* path, char* mode);
```

​		Boinc提供了一些文件操作函数，函数处理了一些问题，例如windows一些文件操作会锁定文件，Boinc提供了API来处理这些问题。用来替换例如`fopen`之类的函数


